@ECHO OFF
SETLOCAL

IF EXIST %CD%\before_docker.cmd CALL %CD%\before_docker.cmd
IF EXIST %CD%\before_docker.bat CALL %CD%\before_docker.bat
SET SCRIPT_ROOT=%~dp0

{{#if docker_file }}
docker build -t {{ container }} -f {{ docker_file }} %SCRIPT_ROOT%
{{/if}}
{{#each create_volumes}}
docker volume create {{@key}} >NUL 2>&1
{{/each}}
docker run --rm -it %EXTRA_DOCKER_COMMANDS% ^
{{#each volumes}}
-v {{@key}}:{{this}} ^
{{/each}}
{{#if working_directory}}
-w {{working_directory}} ^
{{/if}}
{{#each ports}}
-p {{@key}}:{{this}} ^
{{/each}}
{{ container }} {{ command }} %*

SET LAST_ERROR=%ERRORLEVEL%

IF EXIST %CD%\after_docker.cmd CALL %CD%\after_docker.cmd
IF EXIST %CD%\after_docker.bat CALL %CD%\after_docker.bat

ENDLOCAL
EXIT /B %LAST_ERROR%
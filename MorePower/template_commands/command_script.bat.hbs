@ECHO OFF
SETLOCAL

IF EXIST %CD%\before_docker.cmd CALL %CD%\before_docker.cmd
IF EXIST %CD%\before_docker.bat CALL %CD%\before_docker.bat
SET SCRIPT_ROOT=%~dp0

{{#if docker_file }}
docker build -t {{ container }} -f %SCRIPT_ROOT%MorePower\DockerFile.google-chrome %SCRIPT_ROOT%
{{/if}}

docker volume create google-chrome-cache >NUL 2>&1
docker volume create google-chrome-config >NUL 2>&1

docker run --rm -it %EXTRA_DOCKER_COMMANDS% ^
{{#each volumes}}
--volume {{@key}}:{{this}} ^
{{/each}}
{{#if working_directory}}
--workdir {{working_directory}} ^
{{/if}}
{{#each ports}}
--expose {{@key}}:{{this}} ^
{{/each}}
{{ container }} {{ command }} %*

SET LAST_ERROR=%ERRORLEVEL%

IF EXIST %CD%\after_docker.cmd CALL %CD%\after_docker.cmd
IF EXIST %CD%\after_docker.bat CALL %CD%\after_docker.bat

ENDLOCAL
EXIT /B %LAST_ERROR%